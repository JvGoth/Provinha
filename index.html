<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulado Estruturado de Gen√©tica M√©dica - UFU</title>
    <!-- Carrega Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* Define a fonte Inter, se dispon√≠vel, para um visual moderno */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Customiza o scrollbar para melhor est√©tica */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background-color: #94a3b8;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-track {
            background: #e2e8f0;
        }
        .time-up {
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 100% { background-color: #ef4444; }
            50% { background-color: #b91c1c; }
        }
    </style>
</head>
<body class="bg-slate-100 min-h-screen font-sans">

    <!-- Container principal onde o JavaScript ir√° gerar o conte√∫do -->
    <div id="root" class="max-w-6xl mx-auto p-4 sm:p-8">
        <div id="header-container"></div>
        <div id="results-summary"></div>
        <section id="closed-questions-section" class="space-y-10 mb-10"></section>
        <section id="open-questions-section" class="space-y-6"></section>
        <div id="footer-container"></div>
    </div>

    <script>
        // --- DEFINI√á√ÉO DOS TEMAS E POOLS DE QUEST√ïES (SEM NOTA√á√ÉO LATEX) ---
        const FULL_POOLS = {
            'cat1': {
                nome: 'Introdu√ß√£o, Hist√≥ria e Conceitos B√°sicos',
                cor: 'blue',
                fechadas: [
                    { id: 1, pergunta: 'Quem √© considerado o "pai da gen√©tica" e em que ano publicou seus trabalhos fundamentais com ervilhas?', opcoes: ['Charles Darwin, 1859', 'Gregor Mendel, 1865', 'Watson e Crick, 1953', 'Thomas Hunt Morgan, 1910'], correta: 1, tema: 'cat1' },
                    { id: 2, pergunta: 'O que o conceito de Pang√™nese (Hip√≥crates) sugeria sobre a heran√ßa?', opcoes: ['Heran√ßa de caracteres adquiridos', 'Heran√ßa particulada por genes', 'Mistura de fluidos corporais', 'Apenas o pai contribu√≠a'], correta: 0, tema: 'cat1' },
                    { id: 3, pergunta: 'Qual √© o foco principal de estudo da Gen√©tica de Transmiss√£o?', opcoes: ['Estrutura do DNA', 'Frequ√™ncias al√©licas em popula√ß√µes', 'Como caracter√≠sticas s√£o passadas de gera√ß√£o a gera√ß√£o', 'S√≠ntese de prote√≠nas'], correta: 2, tema: 'cat1' },
                    { id: 4, pergunta: 'A estrutura do DNA, dupla h√©lice antiparalela, foi proposta em qual ano?', opcoes: ['1900', '1944', '1953', '1968'], correta: 2, tema: 'cat1' },
                    { id: 5, pergunta: 'Qual dos seguintes N√ÉO √© uma raz√£o pela qual os humanos s√£o ruins para estudos gen√©ticos?', opcoes: ['Longo tempo de gera√ß√£o', 'N√£o √© poss√≠vel controle de reprodu√ß√£o', 'Prole pequena', 'N√£o h√° variabilidade gen√©tica'], correta: 3, tema: 'cat1' },
                    { id: 6, pergunta: 'Qual √© a principal diferen√ßa entre Genoma e Cari√≥tipo?', opcoes: ['Genoma √© o n√∫mero de cromossomos; Cari√≥tipo √© a sequ√™ncia de DNA.', 'Genoma √© a totalidade do DNA; Cari√≥tipo √© a organiza√ß√£o vis√≠vel dos cromossomos.', 'Genoma √© apenas o DNA mitocondrial; Cari√≥tipo √© o nuclear.', 'N√£o h√° diferen√ßa.'], correta: 1, tema: 'cat1' },
                    { id: 7, pergunta: 'O que a Teoria da Mistura (Blending Inheritance) n√£o conseguiu explicar?', opcoes: ['A domin√¢ncia de certos tra√ßos.', 'A variabilidade entre a prole.', 'O ressurgimento de tra√ßos parentais em gera√ß√µes subsequentes.', 'A segrega√ß√£o de fatores.'], correta: 2, tema: 'cat1' },
                    { id: 8, pergunta: 'O que √© um loco (locus)?', opcoes: ['O gene dominante.', 'O par de alelos.', 'A localiza√ß√£o f√≠sica de um gene em um cromossomo.', 'A forma alternativa de um gene.'], correta: 2, tema: 'cat1' },
                    { id: 9, pergunta: 'Qual das seguintes √°reas da gen√©tica tem como foco o estudo das frequ√™ncias al√©licas em popula√ß√µes?', opcoes: ['Gen√©tica de Transmiss√£o.', 'Citogen√©tica.', 'Gen√©tica Molecular.', 'Gen√©tica de Popula√ß√µes.'], correta: 3, tema: 'cat1' },
                    { id: 10, pergunta: 'Quem foi um proponente da Teoria do Germoplasma, que refutou a heran√ßa de caracteres adquiridos?', opcoes: ['Arist√≥teles.', 'Lamarck.', 'Weismann.', 'Mendel.'], correta: 2, tema: 'cat1' },
                ],
                abertas: [
                    { id: 1, pergunta: 'Explique a diferen√ßa entre Gen√©tica de Transmiss√£o, Gen√©tica Molecular e Gen√©tica de Popula√ß√µes.', gabarito: '**Resposta:** Gen√©tica de Transmiss√£o estuda como as caracter√≠sticas s√£o passadas entre gera√ß√µes (heredogramas, Leis de Mendel). **Contexto:** A Gen√©tica Molecular estuda a estrutura, organiza√ß√£o e fun√ß√£o dos genes (DNA, RNA, prote√≠nas). A Gen√©tica de Popula√ß√µes estuda a composi√ß√£o gen√©tica de grupos de indiv√≠duos e a mudan√ßa das frequ√™ncias al√©licas ao longo do tempo.', tema: 'cat1' },
                    { id: 2, pergunta: 'Descreva brevemente a Teoria do Germoplasma de Weismann e por que ela refutou a Pang√™nese.', gabarito: '**Resposta:** A Teoria do Germoplasma afirma que o material gen√©tico (germoplasma) est√° separado das c√©lulas som√°ticas (somatoplasma). **Contexto:** Isso refuta a Pang√™nese, que sugeria que informa√ß√µes gen√©ticas de todas as partes do corpo eram levadas aos √≥rg√£os reprodutivos (o que permitiria a heran√ßa de caracteres adquiridos).', tema: 'cat1' },
                    { id: 3, pergunta: 'Qual √© a import√¢ncia da Gen√©tica para a Medicina moderna.', gabarito: '**Resposta:** A Gen√©tica √© crucial para entender a suscetibilidade a doen√ßas, diagn√≥stico de s√≠ndromes gen√©ticas, desenvolvimento de terapias g√™nicas e medicina personalizada. **Contexto:** Isso permite tratamentos mais direcionados e eficazes, al√©m da preven√ß√£o baseada em risco gen√©tico.', tema: 'cat1' },
                    { id: 4, pergunta: 'Cite e explique um conceito que torna o estudo da gen√©tica humana desafiador.', gabarito: '**Resposta:** Longo tempo de gera√ß√£o, Prole pequena, ou a impossibilidade de reprodu√ß√µes controladas. **Contexto:** Estes fatores dificultam a aplica√ß√£o direta das Leis de Mendel e a obten√ß√£o de grandes conjuntos de dados de forma r√°pida, exigindo o uso de heredogramas e m√©todos estat√≠sticos.', tema: 'cat1' },
                    { id: 5, pergunta: 'Qual o papel da miscigena√ß√£o na gen√©tica da popula√ß√£o brasileira, conforme estudos citados nas m√≠dias?', gabarito: '**Resposta:** A miscigena√ß√£o resultou em uma variabilidade gen√©tica √∫nica, com implica√ß√µes para a sa√∫de. **Contexto:** A varia√ß√£o na resposta a certos medicamentos e a preval√™ncia de certas doen√ßas em subgrupos populacionais s√£o consequ√™ncias diretas dessa variabilidade, o que √© relevante para a medicina personalizada.', tema: 'cat1' },
                ]
            },
            'cat2': {
                nome: 'Gen√©tica Mendeliana e Cruzamentos',
                cor: 'green',
                fechadas: [
                    { id: 11, pergunta: 'Qual √© a principal diferen√ßa entre gene e alelo?', opcoes: ['Alelo √© a unidade de heran√ßa; Gene √© a sua varia√ß√£o.', 'Gene √© a unidade de heran√ßa; Alelo √© a forma alternativa do gene.', 'Gene √© sempre dominante; Alelo √© sempre recessivo.', 'N√£o h√° diferen√ßa significativa, s√£o sin√¥nimos.'], correta: 1, tema: 'cat2' },
                    { id: 12, pergunta: 'Qual propor√ß√£o fenot√≠pica √© esperada na $F_2$ de um cruzamento mono√≠brido simples (domin√¢ncia completa)?', opcoes: ['1:1', '3:1', '1:2:1', '9:3:3:1'], correta: 1, tema: 'cat2' },
                    { id: 13, pergunta: 'O que define um indiv√≠duo ser homozigoto?', opcoes: ['Ter um alelo dominante e um recessivo.', 'Expressar o fen√≥tipo recessivo.', 'Ter dois alelos id√™nticos para uma caracter√≠stica.', 'Ter o gen√≥tipo "Aa".'], correta: 2, tema: 'cat2' },
                    { id: 14, pergunta: 'O que √© um cruzamento-teste?', opcoes: ['Cruzamento entre dois heterozigotos.', 'Cruzamento entre um indiv√≠duo de gen√≥tipo desconhecido e um homozigoto dominante.', 'Cruzamento entre dois homozigotos recessivos.', 'Cruzamento entre um indiv√≠duo de gen√≥tipo desconhecido e um homozigoto recessivo.'], correta: 3, tema: 'cat2' },
                    { id: 15, pergunta: 'Na Segunda Lei de Mendel, a segrega√ß√£o independente dos alelos √© observada em qual tipo de cruzamento?', opcoes: ['Mono√≠brido', 'Retrocruzamento', 'Di-h√≠brido', 'Cruzamento-teste'], correta: 2, tema: 'cat2' },
                    { id: 16, pergunta: 'Qual a propor√ß√£o genot√≠pica esperada na $F_2$ de um cruzamento mono√≠brido?', opcoes: ['1:1.', '3:1.', '1:2:1.', '9:3:3:1.'], correta: 2, tema: 'cat2' },
                    { id: 17, pergunta: 'Se um indiv√≠duo tem o gen√≥tipo "Aabb", ele produzir√° quantos tipos de gametas diferentes (em propor√ß√µes iguais)?', opcoes: ['1 (Ab)', '2 (AB e ab)', '3', '4 (AB, Ab, aB, ab)'], correta: 0, tema: 'cat2' },
                    { id: 18, pergunta: 'Qual √© a probabilidade de um cruzamento "Aa" x "Aa" gerar um descendente homozigoto recessivo ("aa")?', opcoes: ['1/2', '1/4', '3/4', '2/3'], correta: 1, tema: 'cat2' },
                    { id: 19, pergunta: 'Qual a rela√ß√£o entre a Segunda Lei de Mendel e a localiza√ß√£o dos genes?', opcoes: ['Aplica-se apenas a genes no mesmo cromossomo.', 'Aplica-se a genes ligados no mesmo cromossomo.', 'Aplica-se a genes localizados em cromossomos diferentes.', 'Apenas genes autoss√¥micos a seguem.'], correta: 2, tema: 'cat2' },
                    { id: 20, pergunta: 'Em um cruzamento-teste de um di-h√≠brido ("AaBb"), qual gen√≥tipo deve ser usado como o indiv√≠duo teste?', opcoes: ['AABB', 'AaBb', 'AAbb', 'aabb'], correta: 3, tema: 'cat2' },
                ],
                abertas: [
                    { id: 6, pergunta: 'Explique a Primeira Lei de Mendel (Lei da Segrega√ß√£o) usando os termos gene, alelo e gameta.', gabarito: '**Resposta:** A Primeira Lei estabelece que cada indiv√≠duo possui dois fatores (genes/alelos) para cada caracter√≠stica. **Contexto:** Esses fatores se separam (segregam) durante a forma√ß√£o dos gametas, de modo que cada gameta recebe apenas um fator. Na fertiliza√ß√£o, os fatores se combinam aleatoriamente, restaurando o par.', tema: 'cat2' },
                    { id: 7, pergunta: 'Em um cruzamento di-h√≠brido ("AaBb" x "AaBb") com domin√¢ncia completa, qual √© a propor√ß√£o genot√≠pica esperada para o gen√≥tipo "AaBb" e qual sua propor√ß√£o fenot√≠pica?', gabarito: '**Resposta:** A propor√ß√£o genot√≠pica esperada para *AaBb* √© 4/16 (ou 1/4). **Contexto:** A propor√ß√£o fenot√≠pica √© o grupo dos "duplos dominantes" (A\_B\_), que √© 9/16, assumindo que A √© dominante sobre a e B √© dominante sobre b.', tema: 'cat2' },
                    { id: 8, pergunta: 'Utilizando a f√≥rmula da expans√£o binomial, escreva a express√£o que representa a probabilidade de um casal ter 5 filhos, sendo 3 albinos (p) e 2 com pigmenta√ß√£o normal (q), sabendo que ambos os pais s√£o heterozigotos para albinismo.', gabarito: '**Resposta:** A probabilidade de um filho ser albino (p) √© 1/4. A probabilidade de pigmenta√ß√£o normal (q) √© 3/4. **Contexto:** A f√≥rmula √© *P = (5! / (3! x 2!)) x p¬≥ x q¬≤*. Onde (5! / (3!2!)) = 10. *P = 10 x (1/4)¬≥ x (3/4)¬≤*.', tema: 'cat2' },
                    { id: 9, pergunta: 'Qual o gen√≥tipo de um indiv√≠duo com o fen√≥tipo dominante (A\_)? Como um cruzamento-teste pode determinar se ele √© homozigoto ou heterozigoto?', gabarito: '**Resposta:** O gen√≥tipo pode ser *AA* (homozigoto dominante) ou *Aa* (heterozigoto). **Contexto:** O cruzamento-teste √© feito com um indiv√≠duo homozigoto recessivo (*aa*). Se a prole for 100% *Aa* (fen√≥tipo dominante), o indiv√≠duo testado √© *AA*. Se a prole for 50% *Aa* (dominante) e 50% *aa* (recessivo), o indiv√≠duo testado √© *Aa*.', tema: 'cat2' },
                    { id: 10, pergunta: 'Em que contexto gen√©tico a probabilidade binomial √© mais √∫til?', gabarito: '**Resposta:** A probabilidade binomial √© usada para calcular a probabilidade de obter uma combina√ß√£o espec√≠fica de resultados em um n√∫mero fixo de eventos (n), onde h√° apenas dois resultados poss√≠veis. **Contexto:** A f√≥rmula *P = (n! / (x!y!)) p^x q^y* √© ideal para calcular a ordem e a frequ√™ncia de eventos independentes, como a sequ√™ncia de nascimentos em uma fam√≠lia.', tema: 'cat2' },
                ]
            },
            'cat3': {
                nome: 'Extens√µes dos Princ√≠pios de Mendel',
                cor: 'red',
                fechadas: [
                    { id: 21, pergunta: 'O que caracteriza a Domin√¢ncia Incompleta?', opcoes: ['O heterozigoto expressa os dois fen√≥tipos parentais simultaneamente.', 'O fen√≥tipo do heterozigoto √© intermedi√°rio entre os dois homozigotos.', 'Um alelo mascara a express√£o de outro alelo em um locus diferente.', 'A caracter√≠stica √© determinada por mais de dois alelos.'], correta: 1, tema: 'cat3' },
                    { id: 22, pergunta: 'A Codomin√¢ncia √© exemplificada classicamente por qual sistema sangu√≠neo humano?', opcoes: ['Sistema Rh', 'Sistema ABO', 'Sistema MN', 'Sistema Duffy'], correta: 2, tema: 'cat3' },
                    { id: 23, pergunta: 'Qual a propor√ß√£o fenot√≠pica esperada em um cruzamento entre dois heterozigotos com um Alelo Letal recessivo (exemplo do camundongo amarelo)?', opcoes: ['3:1', '1:2:1', '2:1', '9:3:3:1'], correta: 2, tema: 'cat3' },
                    { id: 24, pergunta: 'O que significa um gene ter Penetr√¢ncia Incompleta?', opcoes: ['O alelo sempre produz o fen√≥tipo, mas com intensidade vari√°vel.', 'O alelo s√≥ √© expresso em homozigose.', 'O alelo n√£o √© expresso em alguns indiv√≠duos, mesmo que possuam o gen√≥tipo.', 'O gene interage com outro gene para produzir o fen√≥tipo.'], correta: 2, tema: 'cat3' },
                    { id: 25, pergunta: 'A Epistasia √© definida como:', opcoes: ['Intera√ß√£o entre alelos no mesmo locus.', 'Ocorr√™ncia de alelos m√∫ltiplos.', 'A intera√ß√£o entre genes em diferentes loci, onde um gene mascara ou modifica a express√£o de outro.', 'O efeito ambiental no fen√≥tipo.'], correta: 2, tema: 'cat3' },
                    { id: 26, pergunta: 'Em alelos m√∫ltiplos, o sistema sangu√≠neo ABO tem quantos alelos na popula√ß√£o?', opcoes: ['Dois (A e B).', 'Tr√™s (I-A, I-B e i).', 'Quatro (A, B, AB, O).', 'Infinitos.'], correta: 1, tema: 'cat3' },
                    { id: 27, pergunta: 'Em Codomin√¢ncia, o fen√≥tipo do heterozigoto √©:', opcoes: ['Intermedi√°rio.', 'Mascarado.', 'Uma mistura de ambos os alelos.', 'Expressa ambos os alelos simultaneamente.'], correta: 3, tema: 'cat3' },
                    { id: 28, pergunta: 'A Fenilceton√∫ria (PKU) √© um exemplo cl√°ssico de:', opcoes: ['Penetr√¢ncia incompleta.', 'Expressividade vari√°vel.', 'Pleiotropia.', 'Alelos Letais.'], correta: 2, tema: 'cat3' },
                    { id: 29, pergunta: 'Uma propor√ß√£o fenot√≠pica 9:3:4 na prole de um cruzamento di-h√≠brido indica, tipicamente:', opcoes: ['Epistasia dominante.', 'Epistasia recessiva.', 'Domin√¢ncia incompleta.', 'Codomin√¢ncia.'], correta: 1, tema: 'cat3' },
                    { id: 30, pergunta: 'Qual termo descreve a situa√ß√£o em que um alelo causa a morte do organismo (geralmente em est√°gios iniciais) em homozigose?', opcoes: ['Alelos Nulos.', 'Alelos Hipom√≥rficos.', 'Alelos Letais.', 'Alelos Am√≥rficos.'], correta: 2, tema: 'cat3' },
                ],
                abertas: [
                    { id: 11, pergunta: 'Diferencie Codomin√¢ncia de Domin√¢ncia Incompleta e d√™ um exemplo para cada.', gabarito: '**Resposta:** Domin√¢ncia Incompleta: O fen√≥tipo do heterozigoto √© INTERMEDI√ÅRIO (ex: flor vermelha x flor branca = flor rosa). **Contexto:** Codomin√¢ncia: O heterozigoto expressa AMBOS os fen√≥tipos parentais simultaneamente (ex: sangue tipo AB ou MN, onde os alelos s√£o expressos igualmente).', tema: 'cat3' },
                    { id: 12, pergunta: 'Por que o sistema sangu√≠neo ABO √© um exemplo de Alelos M√∫ltiplos?', gabarito: '**Resposta:** O sistema ABO √© determinado por um √∫nico gene (o gene I) que possui mais de dois alelos na popula√ß√£o (tr√™s: I-A, I-B e i). **Contexto:** Alelos m√∫ltiplos referem-se √† exist√™ncia de mais de duas formas al√©licas para um gene em n√≠vel populacional.', tema: 'cat3' },
                    { id: 13, pergunta: 'Explique o conceito de Alelos Letais e o que eles fazem com a propor√ß√£o mendeliana de 3:1.', gabarito: '**Resposta:** Alelos Letais provocam a morte do organismo, geralmente em um est√°gio inicial de desenvolvimento, eliminando certos gen√≥tipos. **Contexto:** Se o alelo letal for recessivo (e matar em homozigose), ele remove o homozigoto recessivo da prole vi√°vel, alterando a propor√ß√£o fenot√≠pica 3:1 para 2:1 (no caso de camundongos amarelos).', tema: 'cat3' },
                    { id: 14, pergunta: 'Diferencie os conceitos de Penetr√¢ncia e Expressividade, dando um exemplo que ilustre a Penetr√¢ncia Incompleta.', gabarito: '**Resposta:** Penetr√¢ncia: √â a porcentagem de indiv√≠duos com um gen√≥tipo que realmente expressa o fen√≥tipo esperado (TUDO ou NADA). Expressividade: √â o grau ou intensidade com que um fen√≥tipo √© expresso (VARI√ÅVEL). **Contexto:** Exemplo de Penetr√¢ncia Incompleta: Algumas pessoas com o gen√≥tipo para polidactilia (dedos extras) n√£o manifestam a caracter√≠stica, mas o gen√≥tipo est√° presente.', tema: 'cat3' },
                    { id: 15, pergunta: 'Qual a propor√ß√£o fenot√≠pica esperada em um cruzamento de di-h√≠bridos ("AaBb" x "AaBb") que segue um padr√£o de Epistasia Recessiva?', gabarito: '**Resposta:** A Epistasia Recessiva (*aa* mascara *B/b*) resulta na propor√ß√£o fenot√≠pica 9:3:4. **Contexto:** Nove para o fen√≥tipo A\_B\_, tr√™s para A\_bb, e quatro para o grupo mascarado (aaB\_ e aabb), que expressam o mesmo fen√≥tipo (recessivo).', tema: 'cat3' },
                ]
            }
        };

        // --- Vari√°veis de Estado (Simulando o useState do React) ---
        let allClosedQuestions = []; // As 15 quest√µes selecionadas
        let allOpenQuestions = []; // As 15 quest√µes selecionadas
        let respostasFechadas = {};
        let respostasAbertas = [];
        let resultadosFechadas = null;
        let verificadas = false;
        let abertasVerificadas = false;
        let tempoRestante = 5400; // 1 hora e 30 minutos em segundos
        let timerId = null;
        let timeIsUp = false;

        // --- FUN√á√ïES DE L√ìGICA ---

        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex !== 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [
                    array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        function formatTime(totalSeconds) {
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function getOptionClass(q, index) {
            if (!verificadas) {
                return respostasFechadas[q.id] === index ? 'bg-blue-200 border-blue-600' : 'hover:bg-gray-100 border-gray-300';
            }

            // Ap√≥s verifica√ß√£o
            if (index === q.correta) {
                return 'bg-green-100 border-green-600 font-bold';
            } else if (respostasFechadas[q.id] === index) {
                return 'bg-red-100 border-red-600 line-through';
            } else {
                return 'bg-white border-gray-300';
            }
        }

        function getResumoPorTema() {
            if (!verificadas) return {};

            const temas = {};
            Object.keys(FULL_POOLS).forEach(key => {
                temas[key] = { acertos: 0, total: 0, nome: FULL_POOLS[key].nome, cor: FULL_POOLS[key].cor };
            });

            allClosedQuestions.forEach(q => {
                const temaKey = q.tema;
                temas[temaKey].total++;
                if (respostasFechadas[q.id] === q.correta) {
                    temas[temaKey].acertos++;
                }
            });
            return temas;
        }

        // --- FUN√á√ïES DE RENDERIZA√á√ÉO (DOM Manipulation) ---

        function renderHeader() {
            const container = document.getElementById('header-container');
            const timerClass = timeIsUp ? 'bg-red-600 text-white time-up' : 'bg-slate-700';

            container.innerHTML = `
                <header class="bg-slate-800 text-white p-6 rounded-xl shadow-2xl mb-8 flex flex-col sm:flex-row justify-between items-center gap-4">
                    <div class="flex items-center gap-4">
                        <span class="w-8 h-8 text-blue-400 text-3xl">üß¨</span>
                        <h1 class="text-2xl sm:text-3xl font-extrabold tracking-tight">
                            Simulado de Gen√©tica M√©dica (UFU)
                        </h1>
                    </div>
                    <div class="flex items-center gap-6">
                        <div id="timer-display" class="flex items-center gap-2 p-2 rounded-lg ${timerClass}">
                            <span class="w-5 h-5 text-yellow-400">‚è≥</span>
                            <span class="font-mono text-lg">${formatTime(tempoRestante)}</span>
                        </div>
                        <div class="flex items-center gap-2 bg-slate-700 p-2 rounded-lg">
                            <span class="w-5 h-5 text-red-400">üìä</span>
                            <span class="font-semibold text-lg">${allClosedQuestions.length + allOpenQuestions.length} Quest√µes</span>
                        </div>
                    </div>
                </header>
            `;
        }

        function renderResultsSummary() {
            const container = document.getElementById('results-summary');
            if (!verificadas || !resultadosFechadas) {
                container.innerHTML = '';
                return;
            }

            const resumoPorTema = getResumoPorTema();
            let temaHtml = '';
            
            Object.values(resumoPorTema).forEach(tema => {
                const percentage = tema.total > 0 ? ((tema.acertos / tema.total) * 100).toFixed(0) : 0;
                temaHtml += `
                    <div class="flex justify-between items-center bg-slate-50 p-3 rounded-md">
                        <div class="flex items-center gap-2">
                            <span class="w-4 h-4 text-${tema.cor}-500">üè∑Ô∏è</span>
                            <span class="text-sm font-medium text-slate-600">${tema.nome}</span>
                        </div>
                        <span class="font-bold text-md text-${tema.cor}-700">${tema.acertos} / ${tema.total} (${percentage}%)</span>
                    </div>
                `;
            });

            container.innerHTML = `
                <section class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-green-500 mb-8">
                    <h2 class="text-2xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                        <span class="w-6 h-6 text-green-600">‚úÖ</span> Resumo de Desempenho (M√∫ltipla Escolha)
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="p-4 bg-green-50 rounded-lg border border-green-200">
                            <p class="text-xl font-bold text-green-700">${resultadosFechadas.acertos}</p>
                            <p class="text-sm text-green-600">Acertos</p>
                        </div>
                        <div class="p-4 bg-red-50 rounded-lg border border-red-200">
                            <p class="text-xl font-bold text-red-700">${resultadosFechadas.incorretos}</p>
                            <p class="text-sm text-red-600">Erros</p>
                        </div>
                        <div class="p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                            <p class="text-xl font-bold text-yellow-700">${resultadosFechadas.naoRespondidas}</p>
                            <p class="text-sm text-yellow-600">N√£o Respondidas</p>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-700 mb-3">Acertos por Categoria (Tag):</h3>
                    <div class="space-y-2">
                        ${temaHtml}
                    </div>
                </section>
            `;
        }

        function renderClosedQuestions() {
            const container = document.getElementById('closed-questions-section');
            let closedHtml = `
                <h2 class="text-3xl font-bold text-slate-700 border-b-2 border-slate-300 pb-2 mb-8 flex items-center gap-2">
                    <span class="w-7 h-7 text-blue-600">‚òëÔ∏è</span> Parte A: 15 Quest√µes de M√∫ltipla Escolha (3 Blocos de 5)
                </h2>
            `;
            let globalQuestionIndex = 0;

            Object.keys(FULL_POOLS).forEach(tagKey => {
                const temaData = FULL_POOLS[tagKey];
                const questionsForTag = allClosedQuestions.filter(q => q.tema === tagKey);
                
                closedHtml += `
                    <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-${temaData.cor}-500">
                        <h3 class="text-2xl font-bold text-${temaData.cor}-700 mb-6 flex items-center gap-3">
                            <span class="w-6 h-6 text-${temaData.cor}-600">üè∑Ô∏è</span> Bloco Tem√°tico: ${temaData.nome}
                        </h3>
                        <div class="space-y-6">
                `;

                questionsForTag.forEach((q, qIndex) => {
                    globalQuestionIndex++;
                    let optionsHtml = '';
                    q.opcoes.forEach((opcao, index) => {
                        const isDisabled = verificadas ? 'disabled' : '';
                        const optionClass = getOptionClass(q, index);
                        const correctBadge = (verificadas && index === q.correta) ? '<span class="ml-3 text-green-700 font-bold flex-shrink-0"> (Correta)</span>' : '';
                        const cursorClass = verificadas || timeIsUp ? 'cursor-not-allowed' : 'cursor-pointer';

                        optionsHtml += `
                            <button
                                data-question-id="${q.id}"
                                data-option-index="${index}"
                                onclick="handleRespostaFechada(${q.id}, ${index})"
                                ${isDisabled}
                                class="w-full text-left p-3 rounded-lg border-2 transition-all duration-200 ${optionClass} ${cursorClass}"
                            >
                                <span class="font-mono font-bold mr-2 text-slate-600">${String.fromCharCode(65 + index)}.</span>
                                <span class="text-slate-700">${opcao}</span>
                                ${correctBadge}
                            </button>
                        `;
                    });

                    closedHtml += `
                        <div id="q-closed-${q.id}" class="p-4 border-b border-slate-100 last:border-b-0">
                            <p class="text-lg font-semibold text-slate-800 mb-3">
                                <span class="text-${temaData.cor}-600 mr-2">${globalQuestionIndex}.</span> ${q.pergunta}
                            </p>
                            <div class="space-y-2">
                                ${optionsHtml}
                            </div>
                        </div>
                    `;
                });

                closedHtml += `
                        </div>
                    </div>
                `;
            });

            const buttonHtml = !verificadas ? `
                <button
                    onclick="handleVerificar()"
                    ${timeIsUp ? 'disabled' : ''}
                    class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg flex items-center gap-2 transition-colors ${timeIsUp ? 'opacity-50 cursor-not-allowed' : ''}"
                >
                    <span class="w-5 h-5">‚ö°</span> Finalizar e Verificar Respostas
                </button>
            ` : `
                <div class="px-6 py-3 bg-slate-400 text-white font-bold rounded-lg cursor-not-allowed">
                    Verificado
                </div>
            `;

            closedHtml += `
                <!-- Bot√£o de Verifica√ß√£o -->
                <div class="bg-slate-200 p-6 rounded-xl border border-slate-300 flex flex-col sm:flex-row justify-between items-center gap-4 mt-6">
                    <div>
                        <h3 class="font-bold text-slate-800 text-lg">Fim da Parte A: 15 Quest√µes Fechadas</h3>
                        <p class="text-sm text-slate-600">Verifique suas respostas para a corre√ß√£o autom√°tica.</p>
                    </div>
                    ${buttonHtml}
                </div>
            `;
            container.innerHTML = closedHtml;
        }

        function renderOpenQuestions() {
            const container = document.getElementById('open-questions-section');
            let openHtml = `
                <h2 class="text-3xl font-bold text-slate-700 border-b-2 border-slate-300 pb-2 mb-8 flex items-center gap-2">
                    <span class="w-7 h-7 text-orange-600">üìù</span> Parte B: 15 Quest√µes Discursivas (Com Contexto)
                </h2>
            `;
            let globalQuestionIndex = allClosedQuestions.length;

            allOpenQuestions.forEach((q, qIndex) => {
                globalQuestionIndex++;
                const temaData = FULL_POOLS[q.tema];
                const colorClass = `border-l-4 border-${temaData.cor}-500`;

                const gabaritoHtml = abertasVerificadas ? `
                    <div class="mt-4 p-4 bg-green-50 rounded-lg text-slate-800 text-sm border border-green-200">
                        <strong class="text-green-700 block mb-1">Gabarito / Contexto Esperado:</strong>
                        ${q.gabarito.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}
                    </div>
                ` : '';

                openHtml += `
                    <div class="bg-white p-6 rounded-xl shadow-md border ${colorClass}">
                        <p class="text-xl font-semibold text-slate-800 mb-4">
                            <span class="text-${temaData.cor}-600 mr-2">${globalQuestionIndex}.</span> ${q.pergunta}
                        </p>
                        <p class="text-xs font-medium text-slate-500 mb-2 flex items-center gap-1"><span class="w-4 h-4">üè∑Ô∏è</span> Tema: ${temaData.nome}</p>
                        <textarea
                            rows="5"
                            data-question-id="${q.id}"
                            oninput="handleRespostaAberta(${q.id}, this.value)"
                            ${abertasVerificadas ? 'disabled' : ''}
                            class="w-full p-3 border border-slate-300 rounded-lg focus:ring-orange-500 focus:border-orange-500 text-slate-700 resize-none ${abertasVerificadas ? 'bg-gray-100 disabled-textarea' : ''}"
                            placeholder="Escreva sua resposta aqui..."
                        >${q.resposta}</textarea>
                        ${gabaritoHtml}
                    </div>
                `;
            });

            const buttonHtml = !abertasVerificadas ? `
                <button
                    onclick="handleLiberarGabaritosAbertas()"
                    class="bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg flex items-center gap-2 transition-colors"
                >
                    <span class="w-5 h-5">üëÅÔ∏è</span> Liberar Gabaritos das 15 Quest√µes
                </button>
            ` : `
                <div class="px-6 py-3 bg-slate-400 text-white font-bold rounded-lg cursor-not-allowed">
                    Gabaritos Liberados
                </div>
            `;

            openHtml += `
                <!-- Bot√£o de Verifica√ß√£o das Abertas -->
                <div class="bg-slate-200 p-6 rounded-xl border border-slate-300 flex flex-col sm:flex-row justify-between items-center gap-4 mt-6">
                    <div>
                        <h3 class="font-bold text-slate-800 text-lg">Fim da Parte B: 15 Quest√µes Discursivas</h3>
                        <p class="text-sm text-slate-600">Use o gabarito para autoavaliar a profundidade e o contexto de suas respostas.</p>
                    </div>
                    ${buttonHtml}
                </div>
            `;
            container.innerHTML = openHtml;
        }

        function renderFooter() {
            const container = document.getElementById('footer-container');
            container.innerHTML = `
                <footer class="mt-10 pt-6 border-t border-slate-300 text-center text-sm text-slate-500">
                    <p>Simulado de Gen√©tica M√©dica - Aplica√ß√£o em JavaScript Vanilla (Puro) e Tailwind CSS.</p>
                </footer>
            `;
        }

        function renderApp() {
            renderHeader();
            renderResultsSummary();
            renderClosedQuestions();
            renderOpenQuestions();
            renderFooter();
        }

        // --- FUN√á√ïES DE L√ìGICA DE EVENTOS (Chamadas nos bot√µes) ---

        function handleRespostaFechada(id, index) {
            if (verificadas || timeIsUp) return;
            respostasFechadas[id] = index;
            renderClosedQuestions();
        }
        window.handleRespostaFechada = handleRespostaFechada;

        function handleRespostaAberta(id, value) {
            // Encontra a quest√£o na lista e atualiza a resposta
            const q = allOpenQuestions.find(q => q.id === id && q.tema === event.target.dataset.tema);
            if (q) {
                q.resposta = value;
            }
            // N√£o precisa de rerender completo, o navegador j√° atualizou o textarea
        }
        window.handleRespostaAberta = handleRespostaAberta;

        function handleVerificar() {
            if (verificadas) return;

            clearInterval(timerId);
            verificadas = true;

            let acertos = 0;
            let incorretos = 0;
            const totalQuestoes = allClosedQuestions.length;

            allClosedQuestions.forEach(q => {
                const respostaUsuario = respostasFechadas[q.id];
                if (respostaUsuario === q.correta) {
                    acertos++;
                } else if (respostaUsuario !== undefined) {
                    incorretos++;
                }
            });

            resultadosFechadas = { acertos, incorretos, naoRespondidas: totalQuestoes - acertos - incorretos };
            renderApp(); // Rerenderiza tudo para mostrar os resultados e cores
        }
        window.handleVerificar = handleVerificar;

        function handleLiberarGabaritosAbertas() {
            if (abertasVerificadas) return;
            abertasVerificadas = true;
            renderOpenQuestions();
        }
        window.handleLiberarGabaritosAbertas = handleLiberarGabaritosAbertas;

        // --- INICIALIZA√á√ÉO E TIMER ---

        function initializeQuestions() {
            // Seleciona 5 fechadas e 5 abertas de cada pool
            allClosedQuestions = [];
            allOpenQuestions = [];

            Object.keys(FULL_POOLS).forEach(key => {
                const pool = FULL_POOLS[key];
                
                // Seleciona 5 fechadas aleatoriamente
                const closedPool = shuffle([...pool.fechadas]);
                const selectedClosed = closedPool.slice(0, 5);
                allClosedQuestions.push(...selectedClosed);
                
                // Seleciona 5 abertas aleatoriamente (nesse caso, 5 de 5, apenas embaralha)
                const openPool = shuffle([...pool.abertas]);
                const selectedOpen = openPool.slice(0, 5);
                allOpenQuestions.push(...selectedOpen.map(q => ({...q, resposta: ''}))); // Adiciona campo resposta
            });
            
            // Embaralha as listas finais para misturar os temas (opcional, mas bom para a experi√™ncia)
            allClosedQuestions = shuffle(allClosedQuestions);
            allOpenQuestions = shuffle(allOpenQuestions);

            // Inicializa as respostas fechadas como objeto vazio
            respostasFechadas = {};
        }

        function startTimer() {
            const timerDisplayContainer = document.getElementById('timer-display');
            
            function updateTimer() {
                if (tempoRestante <= 0) {
                    clearInterval(timerId);
                    tempoRestante = 0;
                    timeIsUp = true;
                    // For√ßa a verifica√ß√£o e desabilita bot√µes se o tempo acabar
                    if (!verificadas) {
                       handleVerificar(); 
                    } else {
                       renderHeader();
                       renderClosedQuestions();
                    }
                    return;
                }

                if (timerDisplayContainer) {
                    const timeSpan = timerDisplayContainer.querySelector('span:last-child');
                    if (timeSpan) {
                        timeSpan.textContent = formatTime(tempoRestante);
                        if (tempoRestante <= 300 && !timeIsUp) { // Alerta visual nos √∫ltimos 5 minutos
                            timerDisplayContainer.classList.add('bg-red-500', 'time-up');
                            timerDisplayContainer.classList.remove('bg-slate-700');
                        }
                    }
                }
                tempoRestante--;
            }

            // Garante que n√£o h√° timers m√∫ltiplos
            if (timerId) clearInterval(timerId);

            if (timerDisplayContainer) {
                timerId = setInterval(updateTimer, 1000);
            }
        }

        // --- PONTO DE ENTRADA ---
        window.onload = function() {
            initializeQuestions();
            renderApp();
            startTimer();
        };
    </script>
</body>
</html>
